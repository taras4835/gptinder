# Эксперимент с рекомендательной системой на синтетических данных

Этот проект создан для проведения эксперимента с различными подходами к рекомендации пользователей на основе анализа их диалогов с ИИ.

## Цель эксперимента

Сравнить эффективность различных методов рекомендации пользователей:
1. **Полный перебор**: сравнение каждого сообщения с каждым с использованием GPT
2. **Фильтрация на основе эмбеддингов пользователей**: сначала отбираем похожих пользователей по эмбеддингам, затем проверяем релевантность их сообщений с помощью GPT
3. **Фильтрация на основе эмбеддингов сообщений**: сначала отбираем похожие сообщения по эмбеддингам, затем проверяем их релевантность с помощью GPT

Метрика для сравнения:
```
Metric = (Successful_Pairs / Total_Comparisons) * (1 − Gini(User_Pair_Recommendations))
```

## Используемые модели

- **Генерация текста и оценка релевантности**: `gpt-4.1-nano-2025-04-14`
- **Генерация эмбеддингов**: `text-embedding-3-small`

## Требования

- Python 3.8+
- OpenAI API ключ
- Установленные библиотеки (см. инструкцию по установке)

## Структура проекта

- `generate_data.py` - скрипт для генерации синтетических данных
- `analyze_data.py` - скрипт для анализа данных и проведения эксперимента
- `run_experiment.py` - скрипт для запуска всего процесса
- `.env` - файл с переменными окружения (API ключ)
- `data/` - директория для сгенерированных данных

## Установка и настройка

1. Активируйте виртуальное окружение:
```
source venv/bin/activate
```

2. Установите необходимые библиотеки:
```
pip install openai pandas tqdm scikit-learn matplotlib numpy python-dotenv
```

3. Убедитесь, что в файле `.env` указан ваш OpenAI API ключ:
```
OPENAI_API_KEY=ваш_ключ
```

## Запуск эксперимента

### Полный эксперимент
```
python run_experiment.py
```

### Только генерация данных
```
python run_experiment.py --mode generate --users 10
```

### Только анализ (используя ранее сгенерированные данные)
```
python run_experiment.py --mode analyze
```

## Параметры командной строки
- `--users` - количество пользователей для генерации (по умолчанию: 5)
- `--mode` - режим работы: 
  - `generate` - только генерация данных
  - `analyze` - только анализ данных
  - `both` - и генерация, и анализ (по умолчанию)

## Результаты

После выполнения эксперимента результаты будут сохранены в директории `data/results/`:
- `summary.json` - сводные результаты всех методов
- `metrics_comparison.png` - визуализация результатов сравнения
- `brute_force_results.json` - детальные результаты метода полного перебора
- `user_embedding_results.json` - детальные результаты метода фильтрации по эмбеддингам пользователей
- `message_embedding_results.json` - детальные результаты метода фильтрации по эмбеддингам сообщений

## Примечания

- Для реального эксперимента рекомендуется использовать большее количество пользователей и сообщений
- API ключ может быть заблокирован при превышении лимитов обращений к OpenAI
- В скриптах используются задержки между запросами к API для предотвращения превышения лимитов 